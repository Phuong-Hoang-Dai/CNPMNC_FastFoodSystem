@model AgentManager.WebApp.Models.ViewModel.AddShipmentsVM

@{
    ViewData["Title"] = "Create";
    Layout = "~/Views/Shared/_mLayout.cshtml";
}

<h1>Create</h1>

<h4>FFSDeliveryRecievedNote</h4>
<hr />
<div class="row">
    <div class="col-md-4">
        <div class="form-group col-sm" id="Add">
            <div class="btn btn-success">
                +
            </div>
        </div>
    </div>
</div>

<form asp-action="Create">
    <div id="DynamicList" class="container text-center">
        <div class="row align-items-start" id="DynamicItem">
            <div class="form-group col-sm ml-2">
                    <select aria-label="Hãy chọn nguyên liệu" asp-for="Shipments[0].FFSIngredientId" class="form-control" asp-items="ViewBag.Ingredients"></select>
            </div>
            <div class="form-group col-sm ml-2">
                <input placeholder="Nhập số lượng" asp-for="Shipments[0].Quantity" class="form-control" />
            </div>
            <div class="form-group col-sm row ml-2 flex-nowrap">
                <div class="input-group-text">NSX: </div>
                <input asp-format="{0:dd/MM/yyyy}" placeholder="Ngày sản xuất" asp-for="Shipments[0].StartDate" class="form-control" />
            </div>
            <div class="form-group col-sm row ml-2 flex-nowrap">
                <div class="input-group-text">HSD: </div>
                <input asp-format="{0:dd/MM/yyyy}" placeholder="Ngày hết hạn" asp-for="Shipments[0].EndDate" class="form-control" />
            </div>
            <div class="form-group col-sm deletebtn" id="Delete">
                <div class="btn btn-danger">
                        -
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-12">
            <a asp-action="Index" class="btn btn-secondary">Cancel</a>
            <input type="submit" value="Tạo" class="btn btn-success float-right">
        </div>
    </div>
</form>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script type="text/javascript">
        var rowCount = 1;
        $("#Add").click(function (e) {

            e.preventDefault(); // Ngăn chặn sự kiện mặc định của nút "#add".
            rowCount++;
            // Tính toán số thứ tự của các phần tử ".items".
            var i = rowCount;

            var model = @Html.Raw(ViewBag.JsonIngredients);
            console.log($(".deletebtn"));
            console.log(model);

            // Tạo một chuỗi HTML đại diện cho một hàng mới trong bảng và thêm vào #item-list.
            var n = '<div class="row align-items-start" id="DynamicItem" >'+
                        '<div class="form-group col-sm ml-2" >' +
                            '<select id = "DynamicItem_' + i + '" aria-label="Hãy chọn nguyên liệu" name= "Shipments[' + i + '].FFSIngredientId" class= "form-control"></select>' +
                        '</div>'+
                        '<div class="form-group col-sm ml-2">'+
                            '<input placeholder="Nhập số lượng" name="Shipments['+i+'].Quantity" class="form-control"/>'+
                        '</div>'+
                        '<div class= "form-group col-sm row ml-2 flex-nowrap" >'+
                            '<div class= "input-group-text" > NSX: </div>'+
                        '<input placeholder = "Ngày sản xuất" name= "Shipments['+i+'].StartDate" class= " form-control" />' +
                        '</div>'+
                        '<div class= "form-group col-sm row ml-2 flex-nowrap" >'+
                            '<div class= "input-group-text" > HSD: </div>'+
                            '<input placeholder = "Ngày hết hạn" name= "Shipments[' + i + '].EndDate" class= "form-control" />' +
                        '</div>'+
                            '<div class= "form-group col-sm deletebtn" id ="Delete" >' +
                            '<div class="btn btn-danger" >-</div>'+
                        '</div>'+
                    '</div>';

            $("#DynamicList").append(n);

            var Items = "";

            // Duyệt qua các mục trong model và tạo các tùy chọn cho một thẻ select.
            $(model).each(function () {
                Items = Items + '<option value="' + this.Value + '">' + this.Text + '</option>';
            });

            // Chọn thẻ select cần điền tùy chọn và thêm các tùy chọn vào đó.
            var subItemList = $("#DynamicItem_" + i);
            subItemList.empty(); // Xóa tất cả các tùy chọn hiện có.
            subItemList.append(Items); // Thêm các tùy chọn mới vào thẻ select.
            $(".deletebtn").click(function (e) {
                $(this).closest("#DynamicItem").remove(); // Xóa hàng chứa nút "Delete" được nhấp
            });
        });
        $(".deletebtn").click(function (e) {
            $(this).closest("#DynamicItem").remove(); // Xóa hàng chứa nút "Delete" được nhấp
        });
    </script>
}
